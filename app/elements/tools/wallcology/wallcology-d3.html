<!DOCTYPE html>
<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
</head>

<dom-module id="wallcology-d3">
  <style>

    .chart rect {
      fill: steelblue;
    }

    .chart text {
      fill: white;
      font: 10px sans-serif;
      text-anchor: end;
    }

    .pink {
      background-color: var(--paper-pink-500);
    }

    .hcontainer {
      @apply(--layout-horizontal);
      @apply(--layout-center-justified);
    }
    paper-material {
      background-color: white;;
      height: 100%;
      margin-top: 2px;
      padding: 6px;
    }

  </style>
  <template>
    <paper-material elevation="1">
    <div class="hcontainer">
      <svg class="chart"></svg>
    </div>
      </paper-material>
  </template>
  <script>
  // element registration
  Polymer({
    is: 'wallcology-d3',

    // add properties and methods on the element's prototype
    properties: {
      // declare properties for the element's public API
      data : {
        type: Array,
        value: [4, 8, 15, 16, 23, 42],
        notify: true
      },
      currentHabitat: {
        type: Object,
        notify: true,
        observer: 'currentHabitatChanged'
      },
      selectedBugs: {
        type: Array,
        notify: true,
        value: [],
        observer: 'selectedBugsChanged'
      },
    },
    currentHabitatChanged: function(newValue, oldValue) {
      console.log('D3 currentHabitatChanged oldValue: ' + oldValue + ' : ' + newValue);
      this.redraw();
    },
    selectedBugsChanged: function(newValue, oldValue) {
      console.log('D3 selectedBugs changed oldValue: ' + oldValue + ' : ' + newValue);
      this.redraw();
    },
    redraw: function() {
      var data = [4, 8, 15, 16, 23, 42];

      var width = 420,
        barHeight = 20;

      var x = d3.scale.linear()
        .domain([0, d3.max(data)])
        .range([0, width]);

      var chart = d3.select(".chart")
        .attr("width", width)
        .attr("height", barHeight * data.length);

      var bar = chart.selectAll("g")
        .data(data)
        .enter().append("g")
        .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

      bar.append("rect")
        .attr("width", x)
        .attr("height", barHeight - 1);

      bar.append("text")
        .attr("x", function(d) { return x(d) - 3; })
        .attr("y", barHeight / 2)
        .attr("dy", ".35em")
        .text(function(d) { return d; });
    },
    init: function() {
      this.redraw();
    },
    ready: function () {
      this.currentHabitat = {};
      this.selectedBugs = [];
      this.data = [4, 8, 15, 16, 23, 42];
      this.init();
    }
  });
</script>
</dom-module>


